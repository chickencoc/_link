<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tools</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Acme&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-size: 13px; }

        .acme-regular { font-family: "Acme", sans-serif; font-weight: 400; font-style: normal;}

        div#header_box { padding: 1em 2em; text-transform: uppercase; }
        div#section_box { padding: 0 2em; padding-bottom: 15em; display: flex; flex-wrap: wrap; }
        section { border-bottom: 1px solid #ccc; padding: 2em 0; margin: 0 1%; flex-basis: 48%; flex-grow: 1; }
        section > div.content_box { margin: 0 1.5em; }
        section > div.content_box > *:not(:first-child) { margin-top: 1.75em; }

        textarea { border: none; padding: 10px; border-bottom: 1px solid #ccc; font-family: inherit; width: 100%; }
        input[type="radio"] { margin-right: 4px; vertical-align: middle; }
        label { vertical-align: middle; cursor: pointer; }
        
        button { border: 2px solid #888; padding: 0 8px; background: #fff; border-radius: 4px; cursor: pointer; transition: cubic-bezier(0.4, 0, 0.2, 1) 0.1s; }
        button > span { display: inline-block;}
        button:hover { background-color: #888; border: 2px solid #888; color: #fff; }

        div.obox { color: #555; word-break: break-word; }
        div.obox.pointer { cursor: pointer; }
        div.input_case { margin-bottom: 10px; }
        div.input_case label { margin-right: 8px; }

    /* section1 input style */
        div.s1_ibox { position: relative; margin-top: 35px; }
        div.s1_ibox input { color: #222222; width: 100%; border: none; border-bottom: solid #aaaaaa 1px; padding: 10px; position: relative; background: none; z-index: 5; }
        div.s1_ibox input::placeholder { color: #aaaaaa; }
        div.s1_ibox input:focus { outline: none; }

        div.s1_ibox span { display: block; position: absolute; bottom: 0; left: 0%; /* rightë¡œë§Œ ë°”ê¿”ì£¼ë©´ ì˜¤ - ì™¼ */
        background-color: #666; width: 0; height: 2px; border-radius: 2px; transition: 0.5s; }
        div.s1_ibox label { position: absolute; color: #aaa; left: 3px; font-size: 1.15em; bottom: 8px; transition: all .2s; }

        div.s1_ibox :is(input:focus ~ label, input:valid ~ label) { font-size: 0.8em; left: 3px; bottom: 40px; color: #666; font-weight: bold; }
        div.s1_ibox :is(input:focus ~ span, input:valid ~ span) { width: 100%; }

    /* section 2 input style */
        /* ê³µí†µ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        div.s2_ibox { margin-top: 8px; padding: 8px 0; color: #333; }
        /* ë¼ë²¨ê³¼ ìˆ«ì ì…ë ¥ í•„ë“œ ì¤„ë§ì¶¤ */
        /* div label[for="rnd_length"] { margin-right: 4px; } */
        /* ìˆ«ì ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        div.s2_ibox input[type="number"] { width: 60px; padding: 3px 5px; border: 1px solid #ccc; border-radius: 3px; text-align: center; }
        /* í¬ì»¤ìŠ¤ ì‹œ ìŠ¤íƒ€ì¼ */
        div.s2_ibox input[type="number"]:focus { border-color: #0078d4; outline: none; box-shadow: 0 0 2px rgba(0,120,212,0.3); }
        /* êµ¬ë¶„ì„  ëŠë‚Œ ì£¼ê¸° (ì„¹ì…˜ êµ¬ë¶„) */
        div.s2_ibox + div { border-top: 1px solid #eee; margin-top: 10px; padding-top: 10px; }


    /* section3 input style */


    
        @media screen and (max-width: 700px) {
            div#section_box { display: block; }
        }
    </style>
</head>

<body>
    <div id="header_box" class="box acme-regular">
        <header>
            <h1>
                <span style="color: #2f3e46;">t</span>
                <span style="color: #354f52;">o</span>
                <span style="color: #52796f;">o</span>
                <span style="color: #84a98c;">l</span>
                <span style="color: #cad2c5;">s</span>
            </h1>
        </header>
    </div>
    <div id="section_box" class="box">
        <section id="s1">
            <h2>ğŸ”¹QueryString ë¹ˆ ê°’ ì‚­ì œ</h2>
            <div class="content_box">
                <div class="s1_ibox">
                    <input type="text" id="s1_i1" required/>
                    <label for="s1_i1">querystring</label>
                    <span></span>
                </div>
                <h4>ğŸ”¸output</h4>
                <div id="s1_o1" class="obox">output..</div>
                <h4>ğŸ”¸origin</h4>
                <div id="s1_o2" class="obox">origin..</div>
            </div>
        </section>
        <section id="s2">
            <h2>ğŸ”¹ë¬´ì‘ìœ„ ë¬¸ìì—´ ìƒì„±</h2>
            <div class="content_box">
                <div class="s2_ibox">
                    <div class="input_case">
                        <input type="radio" name="rnd_type" id="rnd_string" value="string" checked>
                        <label for="rnd_string">í˜¼í•© ë¬¸ìì—´</label>
                        <input type="radio" name="rnd_type" id="rnd_alphabet" value="alphabet">
                        <label for="rnd_alphabet">ì˜ë¬¸ ë¬¸ìì—´</label>
                        <input type="radio" name="rnd_type" id="rnd_number" value="number">
                        <label for="rnd_number">ìˆ«ì ë¬¸ìì—´</label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label for="rnd_length">ë¬¸ìì—´ ê¸¸ì´</label>
                        <input type="number" name="rnd_length" id="rnd_length" min="0" max="1024" value="128" oninput="clampNumber(this)">
                        <button id="s2_btn">ìƒì„±<span></span></button>
                    </div>
                </div>
                <h4>ğŸ”¸output<small id="s2_copy_alert"></small></h4>
                <div id="s2_o1" class="obox pointer"></div>
            </div>
        </section>
        <section id="s3">
            <h2>ğŸ”¹Unix Timestamp</h2>
            <div class="content_box">
                <div class="s2_ibox">
                </div>
                <h4>ğŸ”¸timestamp<small id="s3_copy_alert"></small></h4>
                <div id="s3_o1" class="obox pointer"></div>
                <h4>ğŸ”¸local time</h4>
                <div id="s3_o2" class="obox"></div>
            </div>
        </section>
        <section id="s4">
            <h2>ğŸ”¹Base64</h2>
            <div class="content_box">
                <div class="s2_ibox">
                    <div class="input_case">
                        <input type="radio" name="encoding_type" id="s4_ic1" value="enc" checked>
                        <label for="s4_ic1">encoding</label>
                        <input type="radio" name="encoding_type" id="s4_ic2" value="dec">
                        <label for="s4_ic2">decoding</label>
                        <input type="radio" name="encoding_type" id="s4_ic3" value="urlenc">
                        <label for="s4_ic3">url encoding</label>
                        <input type="radio" name="encoding_type" id="s4_ic4" value="urldec">
                        <label for="s4_ic4">url decoding</label>
                    </div>
                    <textarea name="" id="s4_i1"></textarea>
                </div>
                <h4>ğŸ”¸result<small id="s4_copy_alert"></small></h4>
                <div id="s4_o1" class="obox pointer"></div>
            </div>
        </section>
    </div>
</body>
<script>
    // common
    const copyText = (originText, alertTagId) => {
        return navigator.clipboard.writeText(originText)
        .then(() => {
            const span = document.querySelector(alertTagId);
            const txt = span.innerText;
            span.innerText = " [Copied!!]";

            setTimeout(() => {
                span.innerText = txt;
            }, 1500)
        });
    }

    // section 1 "query string"
    document.querySelector('input#s1_i1').addEventListener('input', (e) => {
        let value = e.target.value;

        if (value) {
            const params = new URLSearchParams(value);
            const obj = {};
    
            // URLSearchParams ê°ì²´ë¥¼ ì¼ë°˜ ê°ì²´ë¡œ ë³€í™˜s
            for (const [key, value] of params) {
                obj[key] = value;
            }
    
            // ë¹ˆ ê°’ í•„í„°ë§
            const filteredObj = Object.fromEntries(
                Object.entries(obj).filter(([_, value]) => value !== "" && value !== null && value !== undefined)
            );
    
            // í•„í„°ë§ëœ ê°ì²´ë¥¼ ë‹¤ì‹œ URLSearchParams ê°ì²´ë¡œ ë³€í™˜
            const newParams = new URLSearchParams(filteredObj).toString();
    
            if (newParams) document.querySelector('div#s1_o1').textContent = newParams;

        } else {
            document.querySelector('div#s1_o1').textContent = 'output..';
            value = 'origin..';
        }

        document.querySelector('div#s1_o2').textContent = value;
    })

    // section 2 "random string"
    let sct2CopyFlag = false;

    document.querySelector('button#s2_btn').addEventListener('click', () => {
        const type = document.querySelector('input[name="rnd_type"]:checked')?.value;
        const length = document.querySelector('input#rnd_length')?.value;

        const generator = {
            string: (ll) => generateRandom(ll, 3, 0),
            alphabet: (ll) => generateRandom(ll, 2, 0),
            number: (ll) => generateRandom(ll, 1, 2)
        }

        document.querySelector('div#s2_o1').textContent = generator[type](length);

        sct2CopyFlag = true;
    })

    document.querySelector('div#s2_o1').addEventListener('click', (e) => {
        if(!sct2CopyFlag) return;

        const value = e.target.textContent;
        copyText(value, '#s2_copy_alert');
    })

    const generateRandom = (length, range, offset) => {
        const arr = [[26, 'a'.charCodeAt()], [26, 'A'.charCodeAt()], [10, '0'.charCodeAt()]];

        let result = '';

        for (let i = 0; i < length; i++) {
            const idx = Math.floor(Math.random() * range) + offset;
            const charCode = Math.floor(Math.random() * arr[idx][0]) + arr[idx][1];
            result += String.fromCharCode(charCode);
        }

        return result;
    }

    const clampNumber = (el) => {
        const min = Number(el.min);
        const max = Number(el.max);
        const value = Number(el.value);
        // ì…ë ¥í•œ ê°’ì˜ ìµœëŒ€-ìµœì†Œê°’ ì œí•œ: ìµœì†Œ ë³´ë‹¤ ì‘ì„ ë•Œ, ìµœëŒ€ ë³´ë‹¤ í´ ë•Œ
        el.value = value < min ? min : (value > max ? max : value);
    }

    // section 3 "timestamp"
    const section3 = {
        displayTag1 : document.querySelector("#s3_o1"),
        displayTag2 : document.querySelector("#s3_o2"),
        readTime : function() {
            this.updateTime();

            setInterval(() => this.updateTime(), 1000);
        },
        copyEvent : function () {

            this.displayTag1.addEventListener("click", () => {
                if(!this.copyFlag) return;

                const timeValue = this.displayTag1.textContent;
                copyText(timeValue, "#s3_copy_alert");
            })
        },
        updateTime : function () {
            const date = new Date();
            const time = Math.floor( date.getTime() / 1000 );
            const localTime = date.toLocaleString();
            this.displayTag1.innerText = time;
            this.displayTag2.innerText = localTime;
        }
    }
    section3.readTime();
    section3.copyEvent();

    // section 4
    const section4 = {
        displayTag : document.querySelector("#s4_o1"),
        textarea : document.querySelector("#s4_i1"),
        base64urlencode: (str) => {
            return btoa(unescape(encodeURIComponent(str)))
            .replace(/\+/g, '-')
            .replace(/\//g, '_')
            .replace(/=+$/, ''); // íŒ¨ë”©(=) ì œê±°
        },
        base64urldecode: (base64urlStr) => {
            // 1. ê¸¸ì´ë¥¼ 4ì˜ ë°°ìˆ˜ë¡œ ë§ì¶”ê¸° ìœ„í•´ íŒ¨ë”© ë³µêµ¬
            let base64 = base64urlStr
            .replace(/-/g, '+')
            .replace(/_/g, '/');
            
            while (base64.length % 4) {
                base64 += '=';
            }

            return decodeURIComponent(escape(atob(base64)));
        },
        eventFn : function() {
            const value = this.textarea.value;
            const fnType = document.querySelector("input[name='encoding_type']:checked").value;
            let result  = 'fail';

            try {
                if( fnType == 'enc' ) {
                    result = btoa(value);
                } else if( fnType == 'dec' ) {
                    result = atob(value);
                } else if( fnType == 'urlenc') {
                    result = this.base64urlencode(value);
                } else if( fnType == 'urldec') {
                    result = this.base64urldecode(value);
                }

                this.displayTag.innerText = result;
            } catch (error) {
                this.displayTag.innerText = error.toString().substring( error.toString().lastIndexOf(':') + 1 );
            }
        },
        addEvent : function() {
            this.textarea.addEventListener( 'input', () => this.eventFn() );

            document.querySelectorAll("input[name='encoding_type']").forEach( (e, i) => {
                e.addEventListener('click', () => this.eventFn() );
            });

            this.displayTag.addEventListener('click', (e) => {
                const value = e.target.innerText;
                if(value && value !== "") {
                    copyText(value, "#s4_copy_alert");
                }
            });
        }
    }

    section4.addEvent();


</script>
</html>
